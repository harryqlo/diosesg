<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dioses Griegos: Im√°genes Locales y Texto con IA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Chewy&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif; 
            background-color: #F0F9FF; 
            overscroll-behavior-y: contain; 
        }
        .font-chewy { 
            font-family: 'Chewy', cursive;
        }
        .main-container-app {
            background-color: #E0F2FE; 
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            max-width: 768px; 
            width: 100%;
        }
        .card-section {
            background-color: #BFDBFE; 
            border-radius: 15px;
            padding: clamp(1rem, 5vw, 1.5rem); 
            margin-bottom: 1.25rem; 
        }
        .nav-button, .action-button, .option-button, .god-menu-item-button, .gemini-button {
            transition: all 0.2s ease-in-out; 
            font-family: 'Chewy', cursive;
        }
        .gemini-button {
            background-color: #FCD34D; 
            color: #78350F; 
            padding: 0.625rem 1rem; 
            border-radius: 8px;
            margin-top: 0.625rem; 
            font-size: 1.125rem; 
        }
        .gemini-button:hover {
            background-color: #FBBF24; 
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        .god-menu-item-button {
            background-color: #93C5FD; color: #1E3A8A; display: flex; flex-direction: column;
            align-items: center; padding: 0.75rem; border-radius: 12px; text-align: center; cursor: pointer;
            min-height: 140px; 
            justify-content: center;
        }
        .god-menu-item-button:hover {
            transform: translateY(-4px) scale(1.05); box-shadow: 0 8px 18px rgba(0,0,0,0.2);
            background-color: #60A5FA;
        }
        .god-menu-item-button img, .learning-image-container img, .quiz-image-container img, .modal-image-container img {
            object-fit: cover; 
            border: 3px solid #60A5FA; 
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        .god-menu-item-button img {
             width: 72px; height: 72px; border-radius: 50%; margin-bottom: 0.5rem; 
        }
         .learning-image-container img, .quiz-image-container img, .modal-image-container img {
            width: clamp(120px, 30vw, 150px); 
            height: clamp(120px, 30vw, 150px); 
            border-radius: 15px; margin: auto; 
        }
        .god-menu-item-button span { font-size: 1rem; sm:font-size: 1.1rem; font-weight: 600; }

        .quiz-selection-label {
            display: flex; align-items: center; padding: 0.625rem; background-color: #DBEAFE;
            border-radius: 8px; margin-bottom: 0.5rem; cursor: pointer; font-size: 1rem; sm:font-size: 1.125rem;
        }
        .quiz-selection-label:hover { background-color: #C7D2FE; }
        .quiz-selection-label input[type="checkbox"] { margin-right: 0.75rem; width: 1.125rem; height: 1.125rem; }

        .correct { background-color: #4ADE80 !important; color: white !important; }
        .incorrect { background-color: #F87171 !important; color: white !important; }
        .feedback-animation { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .modal, .gemini-modal { 
            display: none; position: fixed; z-index: 50; left: 0; top: 0; width: 100%; height: 100%; 
            overflow: auto; background-color: rgba(0,0,0,0.65); justify-content: center; align-items: center; 
            padding: 1rem; 
        }
        .modal-content, .gemini-modal-content { 
            background-color: #fff; margin: auto; padding: clamp(1.25rem, 5vw, 1.75rem); border-radius: 15px; 
            text-align: center; width: 100%; max-width: 480px; box-shadow: 0 5px 20px rgba(0,0,0,0.3); 
        }
        .gemini-modal-content p { 
            font-family: 'Inter', sans-serif;
            text-align: left; font-size: 1rem; sm:font-size: 1.05rem; line-height: 1.65; color: #374151;
            max-height: 60vh; overflow-y: auto; margin-bottom:1rem;
        }
        .modal-button, .gemini-modal-button { 
            padding: 0.625rem 1.25rem; border-radius: 10px; 
            font-size: 1.05rem; sm:font-size: 1.1rem; cursor: pointer; margin-top: 0.75rem; margin-left: 0.25rem; margin-right: 0.25rem; 
        }
        
        #learning-section, #quiz-god-selection-section, #quiz-section, #next-question-button, #endGameModal, #geminiChatModal, #geminiMythModal, #geminiAdviceModal { display: none; }
        
        /* .animated-image { animation: pulse-grow 2s infinite ease-in-out; } 
        @keyframes pulse-grow { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.03); } }  */
        /* Animaci√≥n pulse-grow puede quitarse si no se usan GIFs animados */
        
        .god-motto { font-style: italic; color: #2563EB; margin-top: 0.5rem; margin-bottom: 0.75rem; font-size: 1.2rem; sm:font-size: 1.3rem; }
        #god-learn-description { 
            font-family: 'Inter', sans-serif;
            text-align: left; line-height: 1.7; font-size: 1rem; sm:font-size: 1.1rem; color: #1F2937; 
        }
        .loading-indicator { /* Solo para cargas de texto de Gemini ahora */
            display: inline-block; border: 3px solid #E5E7EB; 
            border-top: 3px solid #FBBF24; 
            border-radius: 50%; width: 20px; height: 20px;
            animation: spin 0.8s linear infinite; margin: 5px auto; 
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .title-main { font-size: clamp(2rem, 8vw, 3rem); } 
        .title-section { font-size: clamp(1.5rem, 6vw, 2.25rem); } 
        .title-subsection { font-size: clamp(1.25rem, 5vw, 1.875rem); } 
        
        input[type="text"] {
            font-family: 'Inter', sans-serif;
            color: #1F2937; 
        }
        input[type="text"]::placeholder {
            color: #6B7280; 
        }
        .gemini-interaction-group {
            margin-bottom: 1rem; 
        }

    </style>
</head>
<body class="flex flex-col items-center justify-start min-h-screen p-2 sm:p-4">

    <div id="app-container" class="main-container-app p-4 sm:p-6 md:p-8">
        <header class="mb-4 sm:mb-6">
            <h1 id="main-title" class="font-chewy title-main font-bold text-sky-700">Dioses del Olimpo</h1>
        </header>

        <section id="main-menu-section" class="card-section">
            <h2 class="font-chewy title-section text-indigo-700 mb-4 sm:mb-6">Elige un Dios para Aprender</h2>
            <div id="gods-menu-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 sm:gap-4 mb-6 sm:mb-8"></div>
            <button id="go-to-quiz-selection-button" class="action-button w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg text-xl sm:text-2xl shadow-xl">
                ¬°Ir al Quiz!
            </button>
        </section>

        <section id="learning-section" class="card-section">
            <h2 class="font-chewy title-section text-indigo-700 mb-2">Conoce a: <span id="god-learn-name" class="text-yellow-500"></span></h2>
            <div id="god-learn-image-container" class="learning-image-container my-4 h-auto flex items-center justify-center"> 
            </div>
            <p id="god-learn-motto" class="font-chewy god-motto"></p>
            <p id="god-learn-description" class="min-h-[8em] mb-6"></p> 
            
            <div class="my-4 sm:my-6 p-3 sm:p-4 bg-sky-50 rounded-lg shadow-inner">
                <h3 class="font-chewy title-subsection text-sky-700 mb-3">¬°Interact√∫a con <span id="gemini-interaction-god-name">este Dios</span>!</h3>
                
                <div class="gemini-interaction-group">
                    <input type="text" id="chat-question-input" placeholder="Haz una pregunta al dios..." class="w-full p-2.5 border border-sky-300 rounded-md text-base shadow-sm focus:ring-2 focus:ring-amber-400 focus:border-amber-400">
                    <button id="ask-chat-button" class="gemini-button w-full sm:w-auto mt-2">
                        <span id="ask-chat-button-text">Pregunta</span> ‚ú® 
                        <span id="chat-loading" style="display:none;" class="loading-indicator"></span>
                    </button>
                </div>

                <div class="gemini-interaction-group">
                    <input type="text" id="advice-request-input" placeholder="Cu√©ntale tu peque√±a preocupaci√≥n..." class="w-full p-2.5 border border-sky-300 rounded-md text-base shadow-sm focus:ring-2 focus:ring-amber-400 focus:border-amber-400">
                    <button id="get-advice-button" class="gemini-button w-full sm:w-auto mt-2">
                        <span id="get-advice-button-text">Pide un Consejo</span> ‚ú®
                        <span id="advice-loading" style="display:none;" class="loading-indicator"></span>
                    </button>
                </div>
                
                <div class="gemini-interaction-group">
                    <button id="generate-myth-button" class="gemini-button w-full sm:w-auto">
                        <span id="generate-myth-button-text">Descubre un Mini-Mito</span> ‚ú® 
                        <span id="myth-loading" style="display:none;" class="loading-indicator"></span>
                    </button>
                </div>
            </div>

            <button id="back-to-main-menu-from-learn-button" class="action-button w-full bg-orange-400 hover:bg-orange-500 text-white font-bold py-3 px-6 rounded-lg text-lg sm:text-xl shadow-md mt-4">
                Volver al Men√∫
            </button>
        </section>

        <section id="quiz-god-selection-section" class="card-section">
             <h2 class="font-chewy title-section text-indigo-700 mb-4 sm:mb-6">¬øSobre qu√© Dioses quieres el Quiz?</h2>
            <div id="quiz-gods-checkboxes" class="grid grid-cols-1 sm:grid-cols-2 gap-x-3 sm:gap-x-4 gap-y-2 mb-4 sm:mb-6 max-h-60 overflow-y-auto p-2 bg-sky-50 rounded-lg shadow-inner"></div>
            <div class="flex flex-col sm:flex-row flex-wrap justify-center gap-2 mb-4 sm:mb-6">
                <button id="select-all-gods-button" class="action-button bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg text-base sm:text-md">Seleccionar Todos</button>
                <button id="deselect-all-gods-button" class="action-button bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg text-base sm:text-md">Deseleccionar Todos</button>
            </div>
            <div class="space-y-3 sm:space-y-0 sm:flex sm:flex-col md:flex-row md:space-x-3 justify-center">
                <button id="start-selected-quiz-button" class="action-button w-full md:w-auto bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg text-lg sm:text-xl">¬°Empezar Quiz!</button>
                <button id="back-to-main-menu-from-select-button" class="action-button w-full md:w-auto bg-orange-400 hover:bg-orange-500 text-white font-bold py-3 px-6 rounded-lg text-lg sm:text-xl mt-2 md:mt-0">Volver al Men√∫</button>
            </div>
             <p id="quiz-selection-feedback" class="text-red-600 mt-3 text-md sm:text-lg"></p>
        </section>

        <section id="quiz-section" class="card-section">
            <div id="quiz-image-container" class="quiz-image-container my-4 h-auto flex items-center justify-center"> 
            </div>
            <div id="question-area" class="mb-4 sm:mb-6">
                <p id="question-text" class="font-chewy text-xl sm:text-2xl text-indigo-700 min-h-[3em]"></p>
            </div>
            <div id="options-area" class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4 sm:mb-6"></div>
            <div id="feedback-area" class="mb-3 sm:mb-4 min-h-[2em]">
                <p id="feedback-text" class="text-lg sm:text-xl font-semibold"></p>
            </div>
            <div id="score-area" class="mb-4 sm:mb-6">
                <p class="font-chewy text-xl sm:text-2xl text-purple-700">Puntaje: <span id="score" class="font-bold">0</span></p>
            </div>
            <div class="flex flex-col sm:flex-row gap-2 justify-center">
                <button id="next-question-button" class="action-button w-full sm:w-auto bg-yellow-400 hover:bg-yellow-500 text-yellow-800 font-bold py-3 px-6 rounded-lg text-lg sm:text-xl shadow-md">Siguiente Pregunta</button>
                <button id="quit-quiz-button" class="action-button w-full sm:w-auto bg-gray-400 hover:bg-gray-500 text-white font-bold py-3 px-6 rounded-lg text-lg sm:text-xl shadow-md">Salir del Quiz</button>
            </div>
        </section>

        <div id="endGameModal" class="modal">
            <div class="modal-content">
                <h2 id="modal-title" class="font-chewy title-section text-sky-700 mb-3">¬°Juego Terminado!</h2>
                <p id="modal-score" class="font-chewy text-xl sm:text-2xl text-indigo-600 mb-2"></p>
                <p id="modal-message" class="text-lg sm:text-xl text-sky-600 mb-4"></p>
                <div id="modal-image-container" class="modal-image-container h-auto flex justify-center items-center my-3 sm:my-4"> 
                </div>
                <div class="flex flex-col sm:flex-row justify-center gap-2">
                    <button id="restart-quiz-same-selection-button" class="modal-button bg-green-500 hover:bg-green-600 text-white">Jugar de Nuevo</button>
                    <button id="modal-change-quiz-selection-button" class="modal-button bg-blue-500 hover:bg-blue-600 text-white">Elegir Dioses</button>
                </div>
                 <button id="modal-back-to-main-menu-button" class="modal-button bg-orange-500 hover:bg-orange-600 text-white mt-2">Men√∫ Principal</button>
            </div>
        </div>

        <div id="geminiChatModal" class="gemini-modal">
            <div class="gemini-modal-content">
                <h2 id="gemini-chat-modal-title" class="font-chewy title-section text-amber-600 mb-3">Respuesta Divina... ‚ú®</h2>
                <p id="gemini-chat-response"></p>
                <button id="close-chat-modal-button" class="gemini-modal-button bg-sky-500 hover:bg-sky-600 text-white">Entendido</button>
            </div>
        </div>

        <div id="geminiAdviceModal" class="gemini-modal">
            <div class="gemini-modal-content">
                <h2 id="gemini-advice-modal-title" class="font-chewy title-section text-teal-600 mb-3">Un Consejo Divino... ‚ú®</h2>
                <p id="gemini-advice-response"></p>
                <button id="close-advice-modal-button" class="gemini-modal-button bg-sky-500 hover:bg-sky-600 text-white">¬°Gracias!</button>
            </div>
        </div>
        
        <div id="geminiMythModal" class="gemini-modal">
            <div class="gemini-modal-content">
                <h2 id="gemini-myth-modal-title" class="font-chewy title-section text-purple-600 mb-3">Un Mini-Mito para Ti... ‚ú®</h2>
                <p id="gemini-myth-response"></p>
                <button id="close-myth-modal-button" class="gemini-modal-button bg-sky-500 hover:bg-sky-600 text-white">¬°Genial!</button>
            </div>
        </div>
    </div>

    <script>
        // --- Elementos UI ---
        const mainMenuSection = document.getElementById('main-menu-section');
        const godsMenuGrid = document.getElementById('gods-menu-grid');
        const goToQuizSelectionButton = document.getElementById('go-to-quiz-selection-button');
        
        const learningSection = document.getElementById('learning-section');
        const godLearnNameElement = document.getElementById('god-learn-name');
        const godLearnImageContainer = document.getElementById('god-learn-image-container');
        const godLearnMottoElement = document.getElementById('god-learn-motto');
        const godLearnDescriptionElement = document.getElementById('god-learn-description');
        const backToMainMenuFromLearnButton = document.getElementById('back-to-main-menu-from-learn-button');
        const geminiInteractionGodName = document.getElementById('gemini-interaction-god-name');

        const quizGodSelectionSection = document.getElementById('quiz-god-selection-section');
        const quizGodsCheckboxes = document.getElementById('quiz-gods-checkboxes');
        const selectAllGodsButton = document.getElementById('select-all-gods-button');
        const deselectAllGodsButton = document.getElementById('deselect-all-gods-button');
        const startSelectedQuizButton = document.getElementById('start-selected-quiz-button');
        const backToMainMenuFromSelectButton = document.getElementById('back-to-main-menu-from-select-button');
        const quizSelectionFeedback = document.getElementById('quiz-selection-feedback');

        const quizSection = document.getElementById('quiz-section');
        const quizImageContainer = document.getElementById('quiz-image-container');
        const questionTextElement = document.getElementById('question-text');
        const optionsAreaElement = document.getElementById('options-area');
        const feedbackTextElement = document.getElementById('feedback-text');
        const scoreElement = document.getElementById('score');
        const nextQuestionButton = document.getElementById('next-question-button');
        const quitQuizButton = document.getElementById('quit-quiz-button');
        
        const endGameModal = document.getElementById('endGameModal');
        const modalTitle = document.getElementById('modal-title');
        const modalScoreText = document.getElementById('modal-score');
        const modalMessageText = document.getElementById('modal-message');
        const modalImageContainer = document.getElementById('modal-image-container');
        const restartQuizSameSelectionButton = document.getElementById('restart-quiz-same-selection-button');
        const modalChangeQuizSelectionButton = document.getElementById('modal-change-quiz-selection-button');
        const modalBackToMainMenuButton = document.getElementById('modal-back-to-main-menu-button');
        
        const mainTitleHeader = document.getElementById('main-title');

        // Elementos para Gemini
        const chatQuestionInput = document.getElementById('chat-question-input');
        const askChatButton = document.getElementById('ask-chat-button');
        const askChatButtonText = document.getElementById('ask-chat-button-text');
        const chatLoading = document.getElementById('chat-loading'); 
        
        const adviceRequestInput = document.getElementById('advice-request-input');
        const getAdviceButton = document.getElementById('get-advice-button');
        const getAdviceButtonText = document.getElementById('get-advice-button-text');
        const adviceLoading = document.getElementById('advice-loading');

        const generateMythButton = document.getElementById('generate-myth-button');
        const generateMythButtonText = document.getElementById('generate-myth-button-text');
        const mythLoading = document.getElementById('myth-loading');

        const geminiChatModal = document.getElementById('geminiChatModal');
        const geminiChatModalTitle = document.getElementById('gemini-chat-modal-title');
        const geminiChatResponse = document.getElementById('gemini-chat-response');
        const closeChatModalButton = document.getElementById('close-chat-modal-button');
        
        const geminiAdviceModal = document.getElementById('geminiAdviceModal');
        const geminiAdviceModalTitle = document.getElementById('gemini-advice-modal-title');
        const geminiAdviceResponse = document.getElementById('gemini-advice-response');
        const closeAdviceModalButton = document.getElementById('close-advice-modal-button');

        const geminiMythModal = document.getElementById('geminiMythModal');
        const geminiMythModalTitle = document.getElementById('gemini-myth-modal-title'); 
        const geminiMythResponse = document.getElementById('gemini-myth-response');
        const closeMythModalButton = document.getElementById('close-myth-modal-button');
        
        let currentLearningGodId = null;

        // --- Datos de los Dioses con URLs de im√°genes y descripciones mejoradas ---
        const godsData = [
            { 
                id: "zeus", name: "Zeus", motto: "¬°El cielo y el trueno me obedecen!",
                description: "Soy Zeus, el rey de todos los dioses ol√≠mpicos y el dios supremo del cielo, los truenos y los rel√°mpagos. Mi hogar es el Monte Olimpo. Mi arma m√°s poderosa es el rayo, que lanzo cuando estoy enfadado o para impartir justicia. Mis s√≠mbolos son el √°guila, el roble y el cetro real. Soy hijo de los titanes Cronos y Rea, y tuve que luchar contra mi padre para liberar a mis hermanos: Hera (que tambi√©n es mi esposa), Poseid√≥n, Hades, Hestia y Dem√©ter. Juntos vencimos a los Titanes en una gran guerra llamada Titanomaquia. Aunque estoy casado con Hera, he tenido muchas aventuras y muchos hijos famosos como H√©rcules, Atenea (que naci√≥ de mi cabeza), Apolo y Artemisa. Soy conocido por ser un l√≠der fuerte, a veces severo, pero tambi√©n justo. En Roma me conocen como J√∫piter.",
                quizQuestion: "¬øCu√°l es mi equivalente romano, tambi√©n conocido como el padre de los dioses?",
                image: "https://photos.fife.usercontent.google.com/pw/AP1GczN-bPW9urrYIQEK8GdGtVsGPtj4pe8rjexu5rliFPHC9d-2ocK_QxXg8w=w616-h616-s-no?authuser=0", 
                symbolImage: "https://placehold.co/150x150/FFEB3B/000000?text=Rayo", 
                hint: "Su nombre empieza con J."
            },
            { 
                id: "hera", name: "Hera", motto: "Reina del Olimpo, guardiana del hogar.",
                description: "Soy Hera, la majestuosa reina de los dioses, hermana y esposa de Zeus. Soy la diosa del matrimonio, las mujeres, el parto y la familia. Mi animal sagrado es el pavo real, cuyas plumas tienen 'ojos' en honor a Argos, mi fiel gigante de cien ojos. Tambi√©n me representan la granada (s√≠mbolo de fertilidad) y la diadema real. Soy muy poderosa y a veces me muestro celosa por las infidelidades de Zeus, castigando a sus amantes y a sus hijos. Mi equivalente romana es Juno. Soy madre de Ares (dios de la guerra) y Hefesto (dios del fuego y la forja).",
                quizQuestion: "Soy la protectora del matrimonio. ¬øCu√°l es mi nombre romano?",
                image: "https://photos.fife.usercontent.google.com/pw/AP1GczM29nd6xm7i8QT6E4q7J9jA_dR46XbIM2OGdnDk1ce3umIS8okrkOz_3Q=w616-h616-s-no?authuser=0", 
                symbolImage: "https://placehold.co/150x150/32CD32/FFFFFF?text=Pavo+Real", 
                hint: "Suena parecido a un mes del a√±o."
            },
            { 
                id: "poseidon", name: "Poseid√≥n", motto: "¬°Las olas tiemblan ante mi tridente!",
                description: "Soy Poseid√≥n, uno de los tres grandes dioses junto a mis hermanos Zeus (cielo) y Hades (inframundo). ¬°Yo gobierno los mares, los oc√©anos y los r√≠os! Tambi√©n soy el dios de los terremotos, por eso me llaman 'El que sacude la tierra', y de los caballos, ¬°incluso dicen que cre√© el primer caballo! Mi s√≠mbolo m√°s conocido es el tridente, un arp√≥n de tres puntas con el que puedo agitar las aguas, crear tormentas o calmar el mar. Mi palacio est√° en las profundidades del oc√©ano. Los delfines y los toros tambi√©n son sagrados para m√≠. En Roma, me conocen como Neptuno.",
                quizQuestion: "Si los romanos me conoc√≠an como Neptuno, ¬øqu√© planeta del sistema solar lleva mi nombre romano?",
                image: "https://photos.fife.usercontent.google.com/pw/AP1GczM4YobrpdQu_U0jlMOUHfu3ay0PXpQ4kaj0iEx9fBBie3lx0iGbGvI96Q=w616-h616-s-no?authuser=0", 
                symbolImage: "https://placehold.co/150x150/4682B4/FFFFFF?text=Tridente", 
                hint: "Es un planeta azul y gaseoso."
            },
            { 
                id: "atenea", name: "Atenea", motto: "Sabidur√≠a y estrategia, mi estandarte.",
                description: "Soy Atenea, diosa de la sabidur√≠a, la inteligencia, las artes, la artesan√≠a, la estrategia en la guerra (la guerra justa e inteligente, no la brutalidad) y la justicia. ¬°Nac√≠ de una forma asombrosa: directamente de la cabeza de mi padre, Zeus, ya adulta y con armadura completa! Soy una guerrera virgen y una gran estratega, por eso ayud√© a muchos h√©roes como Odiseo y Perseo. Mis s√≠mbolos son la lechuza (que representa la sabidur√≠a) y el olivo (s√≠mbolo de paz y prosperidad), que regal√© a la ciudad de Atenas, de la cual soy patrona. El Parten√≥n en Atenas es mi templo m√°s famoso. Mi equivalente romana es Minerva.",
                quizQuestion: "Soy la diosa patrona de una famosa ciudad griega que lleva mi nombre. ¬øCu√°l es?",
                image: "https://photos.fife.usercontent.google.com/pw/AP1GczM5pjVvCEH04PiRrz6p5n7qwfofs_9QELZfXSR2cdfHgAtzTwTbDi4MlQ=w616-h616-s-no?authuser=0", 
                symbolImage: "https://placehold.co/150x150/A9A9A9/FFFFFF?text=Lechuza", 
                hint: "Es la capital de Grecia."
            },
            { 
                id: "apolo", name: "Apolo", motto: "Luz, m√∫sica y arte, mi divina inspiraci√≥n.",
                description: "Soy Apolo, dios de muchas cosas: el sol y la luz (aunque a veces se me confunde con Helios), la m√∫sica y la poes√≠a, la verdad y la profec√≠a, la medicina y la curaci√≥n, y el tiro con arco. ¬°Soy un dios muy talentoso y radiante! Toco la lira de oro, un instrumento que invent√≥ mi hermano Hermes. Soy un arquero infalible con flechas de oro o plata, que pueden traer tanto plagas como curaci√≥n. Mi or√°culo m√°s famoso estaba en Delfos, donde la sacerdotisa Pitia transmit√≠a mis profec√≠as. Soy hijo de Zeus y Leto, y mi hermana gemela es Artemisa. Los romanos tambi√©n me llamaban Apolo.",
                quizQuestion: "¬øEn qu√© famosa ciudad se encontraba mi or√°culo m√°s importante, donde la gente iba a conocer su futuro?",
                image: "https://photos.fife.usercontent.google.com/pw/AP1GczNv1JOM5eNzVpqunHEh0T6sNE-fnQLYTF-IZsMjTUGRYWrkqQl53p5MQw=w411-h616-s-no?authuser=0", 
                symbolImage: "https://placehold.co/150x150/FFC107/000000?text=Lira", 
                hint: "Empieza con la letra D."
            },
            { 
                id: "afrodita", name: "Afrodita", motto: "La belleza y el amor florecen conmigo.",
                description: "Soy Afrodita, la deslumbrante diosa del amor, la belleza, el deseo, el placer y la fertilidad. ¬°Muchos dicen que soy la m√°s hermosa de todas las diosas! Nac√≠ de la espuma del mar (mi nombre significa 'nacida de la espuma') cerca de Chipre, y llegu√© a la orilla sobre una gran concha marina. Mis s√≠mbolos son la paloma, el gorri√≥n, el cisne, la rosa y la manzana. Tengo un cintur√≥n m√°gico, el Cestus, que hace que cualquiera se enamore de quien lo lleva puesto. Mi hijo m√°s famoso es Eros, el dios del amor (conocido como Cupido por los romanos), y estoy casada con Hefesto, el dios herrero, aunque tuve muchos otros amores. Mi equivalente romana es Venus.",
                quizQuestion: "Tengo un cintur√≥n m√°gico que inspira amor y deseo. ¬øC√≥mo se llama?",
                image: "https://photos.fife.usercontent.google.com/pw/AP1GczO3RalRAKt0_MzE4i6Nhlw5pPd1vUGqUKOBfGMeTtOUWIqBUhSIjPml-Q=w411-h616-s-no?authuser=0", 
                symbolImage: "https://placehold.co/150x150/FFB6C1/000000?text=Concha", 
                hint: "Empieza con C."
            },
            { 
                id: "hermes", name: "Hermes", motto: "Veloz como el viento, mensajero divino.",
                description: "Soy Hermes, el m√°s r√°pido y astuto de los dioses. Soy el mensajero personal de Zeus, y tambi√©n el dios de los viajeros, los caminos, el comercio, los pastores, los atletas, los oradores, los pesos y medidas, ¬°y tambi√©n de los ladrones y los tramposos ingeniosos! Soy hijo de Zeus y la pl√©yade Maya. Llevo un sombrero alado (p√©taso), sandalias aladas (talaria) que me permiten volar como el viento, y un bast√≥n m√°gico llamado caduceo, con dos serpientes enrolladas y a veces alas. Fui yo quien invent√≥ la lira usando un caparaz√≥n de tortuga y se la di a Apolo. Tambi√©n gu√≠o las almas de los muertos al Inframundo (psicopompo). Mi equivalente romano es Mercurio.",
                quizQuestion: "Adem√°s de mensajero, ¬øqu√© instrumento musical invent√© y luego regal√© a mi hermano Apolo?",
                image: "https://photos.fife.usercontent.google.com/pw/AP1GczO3RalRAKt0_MzE4i6Nhlw5pPd1vUGqUKOBfGMeTtOUWIqBUhSIjPml-Q=w411-h616-s-no?authuser=0", // Mismo que Afrodita seg√∫n input
                symbolImage: "https://placehold.co/150x150/B0E0E6/000000?text=Sandalias", 
                hint: "Es un instrumento de cuerda."
            },
            { 
                id: "ares", name: "Ares", motto: "¬°La furia de la batalla corre por mis venas!",
                description: "Soy Ares, el dios de la guerra, espec√≠ficamente de su aspecto m√°s violento, brutal y ca√≥tico. ¬°Me encanta el ruido de las espadas y el fragor de la batalla! Soy hijo de Zeus y Hera. Mis s√≠mbolos son la lanza, el casco, el escudo, y a veces el perro, el buitre y el jabal√≠. Mis compa√±eros en la batalla suelen ser mis hijos Deimos (Terror) y Fobos (Miedo), y mi hermana Eris (Discordia). A diferencia de mi hermana Atenea, que representa la estrategia y la guerra justa, yo personifico la sed de sangre y la matanza. Por eso, no siempre fui muy popular entre los otros dioses, ¬°pero los espartanos me admiraban! Mi equivalente romano es Marte.",
                quizQuestion: "Mi equivalente romano es Marte. ¬øQu√© planeta del sistema solar lleva mi nombre romano?",
                image: "https://photos.fife.usercontent.google.com/pw/AP1GczOjCjjW9sWpTvFaILGRftABAGTWeflSmdJgAMENhk5yposk-7qADX1vtQ=w616-h616-s-no?authuser=0", 
                symbolImage: "https://placehold.co/150x150/DC143C/FFFFFF?text=Lanza", 
                hint: "Es conocido como el planeta rojo."
            },
            {
                id: "hades", name: "Hades", motto: "Se√±or del Inframundo, guardi√°n de las almas.",
                description: "Soy Hades, hermano de Zeus y Poseid√≥n. Mientras ellos gobiernan el cielo y el mar, yo soy el rey del Inframundo, el reino de los muertos. Es un lugar oscuro y misterioso, pero yo soy un gobernante justo y severo de las almas. Mi esposa es la bella Pers√©fone, a quien rapt√© para que fuera mi reina (aunque pasa parte del a√±o conmigo y parte con su madre Dem√©ter, explicando las estaciones). Mi perro guardi√°n, Cerbero, tiene tres cabezas y vigila que nadie entre o salga sin permiso. Tambi√©n soy el dios de las riquezas ocultas de la tierra, como los metales preciosos y las gemas (por eso mi nombre romano es Plut√≥n, que significa 'el rico'). Uno de mis objetos m√°s importantes es el casco de invisibilidad, que me permite moverme sin ser visto.",
                quizQuestion: "¬øC√≥mo se llama mi esposa, la reina del Inframundo, que tambi√©n es diosa de la primavera?",
                image: "https://photos.fife.usercontent.google.com/pw/AP1GczPSoclhcsgGsgvgyDNMpe9iq70PRtRgIiWPm3F6qPZfEL9nF99mw9n0Jg=w616-h616-s-no?authuser=0", 
                symbolImage: "https://placehold.co/150x150/696969/FFFFFF?text=Cancerbero", 
                hint: "Su madre es Dem√©ter, diosa de la agricultura."
            },
            {
                id: "artemisa", name: "Artemisa", motto: "Cazadora ind√≥mita, protectora de la naturaleza.",
                description: "Soy Artemisa, diosa de la caza, los animales salvajes, los bosques, la naturaleza virgen, el parto y la virginidad. Soy la hermana gemela de Apolo, hija de Zeus y Leto. Siempre voy armada con mi arco y flechas de plata, y me encanta recorrer los montes acompa√±ada de mis ninfas cazadoras y mis perros de caza. Soy una protectora de los animales j√≥venes y tambi√©n de las muchachas y las mujeres j√≥venes. Se me asocia con la Luna, a menudo llevando una luna creciente en mi frente (aunque a veces se me confunde con Selene, la tit√°nide de la luna). Soy muy independiente y valoro mi libertad. ¬°No me gusta que me interrumpan cuando estoy cazando o descansando en el bosque! Mi equivalente romana es Diana.",
                quizQuestion: "Soy la hermana gemela de un dios muy importante. ¬øQui√©n es mi hermano gemelo?",
                image: "https://photos.fife.usercontent.google.com/pw/AP1GczOCoU4K4njXAPjNWYgkxS-zHjVD3nafdNzJBvfVwlQ6WILhai2Kx0MdJw=s295-no?authuser=0", 
                symbolImage: "https://placehold.co/150x150/8FBC8F/000000?text=Arco", 
                hint: "Es el dios del sol y la m√∫sica."
            }
        ];

        const modalImagePlaceholders = { 
            trophy: "https://placehold.co/150x150/BFDBFE/3B82F6?text=Trofeo",
            wellDone: "https://placehold.co/150x150/32CD32/FFFFFF?text=Bien+Hecho",
            champion: "https://placehold.co/150x150/FFD700/000000?text=Campeon",
            thumbsUp: "https://placehold.co/150x150/32CD32/FFFFFF?text=Pulgar+Arriba",
            book: "https://placehold.co/150x150/ADD8E6/000000?text=Libro"
        };
        
        let currentQuizQuestions = [];
        let currentQuizQuestionIndex = 0;
        let currentScore = 0;
        let audioInitialized = false;
        let selectedGodsForQuiz = [];

        let clickSynth, correctSynth, incorrectSynth, navigationSynth, gameEventSynth, geminiSynth;

        function initializeSounds() { 
            if (audioInitialized) return;
            clickSynth = new Tone.MembraneSynth({ pitchDecay: 0.008, octaves: 3, envelope: { attack: 0.0006, decay: 0.2, sustain: 0 }, volume: -18 }).toDestination();
            correctSynth = new Tone.Synth({ oscillator: { type: "triangle" }, envelope: { attack: 0.005, decay: 0.1, sustain: 0.05, release: 0.3 }, volume: -12 }).toDestination();
            incorrectSynth = new Tone.FMSynth({ harmonicity: 1.2, modulationIndex: 5, oscillator: { type: "square" }, envelope: { attack: 0.01, decay: 0.2, sustain: 0, release: 0.2 }, modulation: { type: "sawtooth" }, modulationEnvelope: { attack: 0.01, decay: 0.1, sustain: 0, release: 0.1 }, volume: -12 }).toDestination();
            navigationSynth = new Tone.PluckSynth({ attackNoise: 0.8, dampening: 5000, resonance: 0.7, volume: -15 }).toDestination();
            gameEventSynth = new Tone.Synth({ oscillator: { type: 'pulse', width: 0.5 }, envelope: { attack: 0.01, decay: 0.4, sustain: 0.1, release: 0.4 }, volume: -10 }).toDestination();
            geminiSynth = new Tone.Synth({ oscillator: {type: "sine"}, envelope: {attack: 0.01, decay: 0.2, sustain: 0.1, release: 0.5}, volume: -10}).toDestination();
            audioInitialized = true;
        }
        
        async function playSound(synthType, note, duration, time) {
            if (!audioInitialized || !Tone.context || Tone.context.state !== 'running') {
                try {
                    await Tone.start();
                    console.log("Contexto de Audio iniciado.");
                    initializeSounds();
                } catch (e) { console.error("Error al iniciar Tone.js:", e); return; }
            }
            let synthInstance;
            switch(synthType) {
                case 'click': synthInstance = clickSynth; break;
                case 'correct': synthInstance = correctSynth; break;
                case 'incorrect': synthInstance = incorrectSynth; break;
                case 'navigation': synthInstance = navigationSynth; break;
                case 'gameEvent': synthInstance = gameEventSynth; break;
                case 'gemini': synthInstance = geminiSynth; break;
                default: console.warn("Tipo de synth desconocido:", synthType); return;
            }
            if (synthInstance) {
                 if (time) synthInstance.triggerAttackRelease(note, duration, time);
                 else synthInstance.triggerAttackRelease(note, duration);
            }
        }

        const NETLIFY_FUNCTION_PATH_GEMINI_TEXT = "/.netlify/functions/gemini-text";

        function createImageElement(src, alt, isLarge = false) { 
            const img = document.createElement('img');
            const fallbackSize = isLarge ? "150x150" : "80x80";
            const fallbackText = isLarge ? alt : (alt.substring(0,3) || "Img"); 
            
            img.src = src || `https://placehold.co/${fallbackSize}/E5E7EB/9CA3AF?text=${encodeURIComponent(fallbackText)}`;
            img.alt = alt;
            img.className = `shadow-md`; 
            
            if (src && !src.startsWith("https://placehold.co")) { 
                img.classList.add('animated-image'); 
            }

            img.onerror = () => { 
                img.src = `https://placehold.co/${fallbackSize}/E5E7EB/9CA3AF?text=${encodeURIComponent("Fallo Carga")}`;
                img.alt = `Error al cargar: ${alt}`;
                img.classList.remove('animated-image');
            };
            return img;
        }
        
        function showLoadingIndicator(container, isLarge = false) { 
            container.innerHTML = '';
            const placeholder = document.createElement('div');
            const loader = document.createElement('div');
            loader.className = 'loading-indicator'; 
            placeholder.appendChild(loader);
            container.appendChild(placeholder);
        }

        function showSection(sectionId) { 
            [mainMenuSection, learningSection, quizGodSelectionSection, quizSection].forEach(sec => sec.style.display = 'none');
            document.getElementById(sectionId).style.display = 'block';
            if (sectionId === 'main-menu-section') mainTitleHeader.textContent = "Dioses del Olimpo";
            if (sectionId === 'quiz-god-selection-section') mainTitleHeader.textContent = "Elige Dioses para el Quiz";
            if (sectionId === 'quiz-section') mainTitleHeader.textContent = "¬°Adivina el Dios!";
        }

        function populateMainMenu() { 
            godsMenuGrid.innerHTML = '';
            godsData.forEach(god => {
                const godButton = document.createElement('button');
                godButton.className = 'god-menu-item-button focus:outline-none focus:ring-2 focus:ring-yellow-400';
                const imgDisplayArea = document.createElement('div'); 
                imgDisplayArea.style.width = '72px'; 
                imgDisplayArea.style.height = '72px';
                imgDisplayArea.style.display = 'flex';
                imgDisplayArea.style.alignItems = 'center';
                imgDisplayArea.style.justifyContent = 'center';

                imgDisplayArea.appendChild(createImageElement(god.image, `[Imagen de ${god.name}]`));
                
                const nameSpan = document.createElement('span');
                nameSpan.textContent = god.name;
                godButton.appendChild(imgDisplayArea); 
                godButton.appendChild(nameSpan);
                godButton.onclick = () => { playSound('click', "C4", "8n"); displayLearnGod(god.id); };
                godsMenuGrid.appendChild(godButton);
            });
        }

        function displayLearnGod(godId) {
            const god = godsData.find(g => g.id === godId);
            if (!god) return;
            currentLearningGodId = god.id;
            
            mainTitleHeader.textContent = `Conoce a ${god.name}`;
            godLearnNameElement.textContent = god.name;
            godLearnMottoElement.textContent = `"${god.motto}"`;
            godLearnDescriptionElement.textContent = god.description;
            chatQuestionInput.value = ''; 
            adviceRequestInput.value = ''; 
            
            geminiInteractionGodName.textContent = god.name;
            askChatButtonText.textContent = `Pregunta a ${god.name}`;
            getAdviceButtonText.textContent = `Pide Consejo a ${god.name}`;
            generateMythButtonText.textContent = `Descubre un Mito de ${god.name}`;
            
            godLearnImageContainer.innerHTML = '';
            godLearnImageContainer.appendChild(createImageElement(god.image, `[Imagen de ${god.name}]`, true));
            
            showSection('learning-section');
            playSound('navigation', "E5", "16n");
        }
        
        function populateQuizGodSelection() { 
            quizGodsCheckboxes.innerHTML = '';
            quizSelectionFeedback.textContent = '';
            godsData.forEach(god => {
                const label = document.createElement('label');
                label.className = 'quiz-selection-label text-lg text-sky-800';
                label.innerHTML = `
                    <input type="checkbox" value="${god.id}" name="quiz_god" class="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500">
                    <span>${god.name}</span>
                `;
                quizGodsCheckboxes.appendChild(label);
            });
            showSection('quiz-god-selection-section');
        }

        function shuffleArray(array) { 
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        function generateQuizQuestions(sourceGodsData) {
            currentQuizQuestions = [];
            const shuffledSourceGods = [...sourceGodsData];
            shuffleArray(shuffledSourceGods);
            for (let i = 0; i < shuffledSourceGods.length; i++) {
                const correctGod = shuffledSourceGods[i];
                const allOtherGods = godsData.filter(g => g.id !== correctGod.id);
                shuffleArray(allOtherGods);
                const options = [correctGod.name];
                for (let j = 0; j < 2 && j < allOtherGods.length; j++) { 
                    options.push(allOtherGods[j].name);
                }
                shuffleArray(options);
                currentQuizQuestions.push({
                    text: correctGod.quizQuestion,
                    godId: correctGod.id, 
                    options: options,
                    answer: correctGod.name,
                    hint: correctGod.hint
                });
            }
        }
        
        function displayQuizQuestion() { 
            if (currentQuizQuestionIndex < currentQuizQuestions.length) {
                const currentQuestion = currentQuizQuestions[currentQuizQuestionIndex];
                questionTextElement.textContent = currentQuestion.text;
                const godForSymbol = godsData.find(g => g.id === currentQuestion.godId);
                
                quizImageContainer.innerHTML = '';
                if (godForSymbol) {
                    quizImageContainer.appendChild(createImageElement(godForSymbol.symbolImage, `[S√≠mbolo de ${currentQuestion.answer}]`, true));
                } else {
                     quizImageContainer.appendChild(createImageElement(null, `[S√≠mbolo no encontrado]`, true));
                }

                optionsAreaElement.innerHTML = '';
                currentQuestion.options.forEach(option => {
                    const button = document.createElement('button');
                    button.textContent = option;
                    button.className = 'option-button w-full bg-sky-500 hover:bg-sky-600 text-white font-semibold py-3 px-4 rounded-lg text-lg md:text-xl shadow focus:outline-none focus:ring-2 focus:ring-yellow-400';
                    button.onclick = () => { playSound('click', "C4", "8n"); checkAnswer(option, button); }
                    optionsAreaElement.appendChild(button);
                });
                feedbackTextElement.textContent = '';
                feedbackTextElement.className = 'text-lg md:text-xl font-semibold';
                nextQuestionButton.style.display = 'none';
            } else {
                endGame();
            }
        }
        function checkAnswer(selectedOption, buttonElement) { 
             const currentQuestion = currentQuizQuestions[currentQuizQuestionIndex];
            const allOptionButtons = optionsAreaElement.querySelectorAll('.option-button');
            allOptionButtons.forEach(btn => btn.disabled = true);
            if (selectedOption === currentQuestion.answer) {
                currentScore++;
                feedbackTextElement.textContent = '¬°Correcto! üéâ';
                feedbackTextElement.classList.add('text-green-500', 'feedback-animation');
                buttonElement.classList.add('correct');
                playSound('correct', "C5", "8n", Tone.now());
                setTimeout(() => playSound('correct', "G5", "8n", Tone.now() + 0.12), 120);
            } else {
                feedbackTextElement.textContent = `¬°Oh no! La respuesta era ${currentQuestion.answer}. ${currentQuestion.hint || ''}`;
                feedbackTextElement.classList.add('text-red-500', 'feedback-animation');
                buttonElement.classList.add('incorrect');
                playSound('incorrect', "C3", "4n");
                allOptionButtons.forEach(btn => {
                    if (btn.textContent === currentQuestion.answer) {
                        btn.classList.add('correct');
                    }
                });
            }
            scoreElement.textContent = currentScore;
            nextQuestionButton.style.display = 'block';
        }
        function nextQuizQuestionHandler() { 
            playSound('click', "E4", "8n");
            currentQuizQuestionIndex++;
            displayQuizQuestion();
        }
        function startQuiz() { 
            currentQuizQuestionIndex = 0;
            currentScore = 0;
            scoreElement.textContent = currentScore;
            const godsToQuiz = godsData.filter(god => selectedGodsForQuiz.includes(god.id));
            generateQuizQuestions(godsToQuiz);
            if (currentQuizQuestions.length === 0) {
                quizSelectionFeedback.textContent = "Error: No hay preguntas para los dioses seleccionados.";
                showSection('quiz-god-selection-section');
                return;
            }
            displayQuizQuestion(); 
            showSection('quiz-section');
            endGameModal.style.display = 'none';
            nextQuestionButton.style.display = 'none';
        }

        function endGame() { 
            playSound('gameEvent', "G4", "2n");
            modalScoreText.textContent = `Tu puntaje: ${currentScore} de ${currentQuizQuestions.length}`;
            let message = "";
            let imageKey = "trophy"; 
            if (currentQuizQuestions.length === 0) {
                 message = "No se generaron preguntas. ¬°Intenta seleccionar algunos dioses!";
                 modalTitle.textContent = "¬°Oh Vaya!";
                 imageKey = "book"; 
            } else if (currentScore === currentQuizQuestions.length) {
                message = "¬°Felicidades! ¬°Eres un experto en Dioses Griegos! üèÜ";
                modalTitle.textContent = "¬°Excelente!";
                imageKey = "champion";
            } else if (currentScore >= currentQuizQuestions.length / 2) {
                message = "¬°Muy bien hecho! Sabes mucho sobre los Dioses. üëç";
                modalTitle.textContent = "¬°Buen Trabajo!";
                imageKey = "wellDone";
            } else {
                message = "¬°Sigue aprendiendo! Los Dioses Griegos son fascinantes. üòä";
                modalTitle.textContent = "¬°No te rindas!";
                imageKey = "book";
            }
            modalMessageText.textContent = message;
            
            modalImageContainer.innerHTML = '';
            modalImageContainer.appendChild(createImageElement(modalImagePlaceholders[imageKey], `[${imageKey}]`, true));
            
            endGameModal.style.display = 'flex';
        }
        
        async function callGeminiAPI(prompt, loadingElement, responseElement, modalElement, modalTitleElement, modalTitleText) { 
            loadingElement.style.display = 'inline-block';
            responseElement.textContent = 'El Olimpo est√° meditando tu pregunta...'; 
            if(modalTitleElement && modalTitleText) modalTitleElement.textContent = modalTitleText;
            playSound('gemini', "C4", "2n");
            
            const payload = { prompt: prompt }; 
            
            try {
                const response = await fetch(NETLIFY_FUNCTION_PATH_GEMINI_TEXT, { 
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                 console.log(`[DEBUG] Netlify Function (Texto) Response Status:`, response.status);
                if (!response.ok) {
                     const errorBody = await response.text();
                     let detailedErrorMessage = `Error de Netlify Function (Texto) (${response.status}): ${errorBody}`;
                     if (response.status === 401 || response.status === 403) {
                        detailedErrorMessage += " Problema de autenticaci√≥n/autorizaci√≥n con la API de Gemini desde la funci√≥n Netlify. Verifica la variable de entorno GOOGLE_GEMINI_API_KEY en Netlify y los permisos de la clave API.";
                     }
                     console.error(detailedErrorMessage);
                     throw new Error(`Error de Netlify Function (Texto): ${response.status}`);
                }
                const result = await response.json(); 

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    responseElement.textContent = text;
                    playSound('gemini', "G4", "2n");
                } else if (result.error) {
                    console.error("Error desde la funci√≥n Netlify (Texto):", result.error, result.details || '');
                    responseElement.textContent = "Parece que las Musas no est√°n inspiradas hoy (error desde funci√≥n). Intenta de nuevo.";
                    playSound('incorrect', "A2", "1n");
                }
                else {
                    console.error("Respuesta inesperada desde la funci√≥n Netlify (Texto):", result);
                    responseElement.textContent = "Parece que las Musas no est√°n inspiradas hoy (respuesta inesperada). Intenta de nuevo.";
                    playSound('incorrect', "A2", "1n");
                }
            } catch (error) {
                console.error("Error llamando a la funci√≥n Netlify para Gemini API:", error);
                responseElement.textContent = "Hubo un problema contactando al Olimpo (v√≠a Netlify). Revisa tu conexi√≥n o intenta m√°s tarde.";
                playSound('incorrect', "A2", "1n");
            } finally {
                loadingElement.style.display = 'none';
                if (modalElement) modalElement.style.display = 'flex';
            }
        }

        askChatButton.addEventListener('click', () => { 
            const userQuestion = chatQuestionInput.value.trim();
            if (!userQuestion) { alert("Por favor, escribe una pregunta para el dios."); return; } 
            if (!currentLearningGodId) return;
            const god = godsData.find(g => g.id === currentLearningGodId);
            if (!god) return;

            const modalTitleText = `${god.name} te Responde... ‚ú®`;
            const prompt = `Eres ${god.name}. Tu lema es "${god.motto}". Un ni√±o curioso de 9 a√±os te pregunta: '${userQuestion}'. Responde en primera persona, como si fueras ${god.name}, de manera sencilla, amigable y fascinante, en aproximadamente 3 o 4 frases. Basa tu respuesta en tu personalidad y poderes descritos como: '${god.description}'. No digas que eres un modelo de lenguaje o una IA, solo act√∫a como ${god.name}. Mant√©n el lenguaje apropiado para un ni√±o.`;
            callGeminiAPI(prompt, chatLoading, geminiChatResponse, geminiChatModal, geminiChatModalTitle, modalTitleText);
        });

        getAdviceButton.addEventListener('click', () => {
            const userProblem = adviceRequestInput.value.trim();
            if (!userProblem) { alert("Por favor, describe tu peque√±a preocupaci√≥n para pedir un consejo."); return; }
            if (!currentLearningGodId) return;
            const god = godsData.find(g => g.id === currentLearningGodId);
            if (!god) return;
            
            const modalTitleText = `Un Consejo de ${god.name}... ‚ú®`;
            const prompt = `Eres ${god.name}, el dios/diosa griego/griega. Tu lema es "${god.motto}". Un ni√±o de 9 a√±os est√° un poco preocupado/a y te cuenta: '${userProblem}'. Como ${god.name}, ¬øqu√© consejo sabio y alentador le dar√≠as en 2-3 frases? Responde en primera persona, usando tu personalidad y poderes como se describen en: '${god.description}'. Mant√©n un lenguaje sencillo y amigable para un ni√±o. No menciones que eres un modelo de lenguaje o IA.`;
            callGeminiAPI(prompt, adviceLoading, geminiAdviceResponse, geminiAdviceModal, geminiAdviceModalTitle, modalTitleText);
        });

        generateMythButton.addEventListener('click', () => { 
            if (!currentLearningGodId) return;
            const god = godsData.find(g => g.id === currentLearningGodId);
            if (!god) return;

            const modalTitleText = `Un Mini-Mito sobre ${god.name}... ‚ú®`;
            const prompt = `Crea un mini-mito o una historia muy corta (3-5 frases) para un ni√±o de 9 a√±os sobre el dios griego ${god.name}. La historia debe ser simple, emocionante y destacar una caracter√≠stica importante del dios. No menciones que eres un modelo de lenguaje o una IA.`;
            callGeminiAPI(prompt, mythLoading, geminiMythResponse, geminiMythModal, geminiMythModalTitle, modalTitleText);
        });

        closeChatModalButton.addEventListener('click', () => { geminiChatModal.style.display = 'none'; playSound('click', "C3", "8n"); });
        closeAdviceModalButton.addEventListener('click', () => { geminiAdviceModal.style.display = 'none'; playSound('click', "C3", "8n"); });
        closeMythModalButton.addEventListener('click', () => { geminiMythModal.style.display = 'none'; playSound('click', "C3", "8n"); });

        goToQuizSelectionButton.addEventListener('click', () => { playSound('click', "D4", "8n"); populateQuizGodSelection(); });
        backToMainMenuFromLearnButton.addEventListener('click', () => { playSound('click', "A3", "8n"); showSection('main-menu-section'); });
        backToMainMenuFromSelectButton.addEventListener('click', () => { playSound('click', "A3", "8n"); showSection('main-menu-section'); });
        selectAllGodsButton.addEventListener('click', () => { playSound('click', "C4", "16n"); quizGodsCheckboxes.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = true); });
        deselectAllGodsButton.addEventListener('click', () => { playSound('click', "C4", "16n"); quizGodsCheckboxes.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false); });
        startSelectedQuizButton.addEventListener('click', () => {
            selectedGodsForQuiz = Array.from(quizGodsCheckboxes.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.value);
            if (selectedGodsForQuiz.length === 0) {
                quizSelectionFeedback.textContent = "¬°Por favor, selecciona al menos un dios para el quiz!";
                playSound('incorrect', "A2", "4n"); return;
            }
            quizSelectionFeedback.textContent = ""; playSound('gameEvent', "C4", "4n"); startQuiz();
        });
        nextQuestionButton.addEventListener('click', nextQuizQuestionHandler);
        quitQuizButton.addEventListener('click', () => { playSound('click', "G3", "8n"); showSection('main-menu-section'); });
        restartQuizSameSelectionButton.addEventListener('click', () => {
            playSound('gameEvent', "C4", "4n"); endGameModal.style.display = 'none';
            if (selectedGodsForQuiz.length > 0) startQuiz(); else populateQuizGodSelection();
        });
        modalChangeQuizSelectionButton.addEventListener('click', () => { playSound('click', "D4", "8n"); endGameModal.style.display = 'none'; populateQuizGodSelection(); });
        modalBackToMainMenuButton.addEventListener('click', () => { playSound('click', "A3", "8n"); endGameModal.style.display = 'none'; showSection('main-menu-section'); });

        function initializeApp() {
            populateMainMenu(); 
            showSection('main-menu-section');
        }

        initializeApp();
    </script>
</body>
</html>
